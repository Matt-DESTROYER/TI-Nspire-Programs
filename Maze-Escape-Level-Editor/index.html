<!DOCTYPE html>
<html lang="en-au">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>TI-Nspire Programs - Maze Escape Level Editor</title>
	<link rel="icon" type="image/png" href="https://Matt-DESTROYER.github.io/TI-Nspire-Programs/calculator-icon.png" />
	<link rel="stylesheet" type="text/css" href="https://Matt-DESTROYER.github.io/TI-Nspire-Programs/CSS/default.css" />
	<link rel="stylesheet" type="text/css" href="https://Matt-DESTROYER.github.io/TI-Nspire-Programs/CSS/maze-escape-level-editor.css" />
</head>

<body>
	<h1>TI-Nspire Programs - Maze Escape Level Editor <img src="https://Matt-DESTROYER.github.io/TI-Nspire-Programs/calculator-icon.png" width="32" height="32"></img></h1>
	<nav>
		<button id="reset">Reset</button>
		<label>&nbsp;&nbsp;&nbsp;Tool:&nbsp;</label>
		<select id="tool" value="Solid Wall">
			<option value="Player Spawn">Player Spawn</option>
			<option value="Level Finish">Level Finish</option>
			<option value="Solid Wall">Solid Wall</option>
		</select>
	</nav>
	<br>
	<canvas id="screen"></canvas>
</body>

<script type="text/javascript">
	const canvas = document.getElementById("screen");
	const ctx = canvas.getContext("2d");
	
	canvas.width = 320;
	canvas.height = 240;
	
	const Input = {};
	
	canvas.addEventListener("mousemove", (e) => {
		e = e || window.event;
		Input.mouseX = e.clientX;
		Input.mouseY = e.clientY;
	});
	
	let tool = "#", grid = [];
	
	const clamp = (number, bound1, bound2) => bound1 < bound2 ? number > bound2 ? bound2 : number < bound1 ? bound1 : number : number > bound1 ? bound1 : number < bound2 ? bound2 : number;
	
	function initGrid() {
		grid = [];
		const row = " ".repeat(32).split("");
		for (let y = 0; y < 24; y++) {
			grid.push(row.slice());
		}
	}
	initGrid();
	
	document.getElementById("reset").addEventListener("click", initGrid);
	
	document.getElementById("tool").addEventListener("input", (e) => {
		switch ((e || window.event).target.value) {
			case "Player Spawn":
				tool = "@";
				break;
			case "Level Finish":
				tool = "*";
				break;
			case "Solid Wall":
				tool = "#";
				break;
			default:
				alert("An unsupported block type was somehow selected...");
				break;
		}
	});
	
	canvas.addEventListener("mousedown", () => {
		console.log(Input.mouseX, Input.mouseY, clamp(~~(Input.mouseX / 10), 0, 31), clamp(~~(Input.mouseY / 10), 0, 23));
		Input.mouseDown = true;
	});
	
	canvas.addEventListener("mouseup", () => {
		if (tool !== "#") {
			grid[clamp(~~(Input.mouseX / 10), 0, 31)][clamp(~~(Input.mouseY / 10), 0, 23)] = tool;
		}
		Input.mouseDown = false;
	});
	
	ctx.strokeStyle = "#000000";
	function render() {
		ctx.fillStyle = "#ffffff";
		ctx.fillRect(0, 0, canvas.width, canvas.height);
		ctx.beginPath();
		for (let y = 0; y <= 24; y++) {
			ctx.moveTo(0, y * 10);
			ctx.lineTo(canvas.width, y * 10);
		}
		for (let x = 0; x <= 32; x++) {
			ctx.moveTo(x * 10, 0);
			ctx.lineTo(x * 10, canvas.height);
		}
		ctx.stroke();
		ctx.closePath();
		for (let y = 0; y < 32; y++) {
			for (let x = 0; x < 24; x++) {
				if (grid[y][x] === "#") {
					ctx.fillStyle = "#000000";
					ctx.fillRect(x * 10, y * 10, 10, 10);
				} else if (grid[y][x] === "@") {
					ctx.fillStyle = "#0000ff";
					ctx.fillRect(x * 10, y * 10, 10, 10);
				} else if (grid[y][x] === "*") {
					ctx.fillStyle = "#008000";
					ctx.fillRect(x * 10, y * 10, 10, 10);
				}
			}
		}
	}
	render();
	
	function update() {
		if (Input.mouseDown) {
			if (tool === "#") {
				grid[clamp(~~(Input.mouseX / 10), 0, 31)][clamp(~~(Input.mouseY / 10), 0, 23)] = tool;
			}
			render();
		}
		window.requestAnimationFrame(update);
	}
	
	update();
</script>

</html>
